analysisfolder = '/Users/dlevenstein/Project Repos/ACh-and-CorticalState/AnalysisScripts/AnalysisFigs/UPDOWNandPupilAnalysis';
UPDOWNPupilAll = GetMatResults(analysisfolder,'UPDOWNandPupilAnalysis');
%genotype = {PupilWhiskAll.genotype};
%[genotypes,~,genotypeidx] = unique(genotype);
%%
UPDOWNpupil = CollapseStruct(UPDOWNPupilAll);

%%
genotype = extractBetween(UPDOWNpupil.name,'_','_');
genotype = genotype(:,:,1);
[genotypes,~,genotypeidx] = unique(genotype);
%genotypes = char(genotypes);
%%
pupcycleUPDOWN.ALL = CollapseStruct(UPDOWNpupil.pupcycleUPDOWN,3);
pupcycleUPDOWN.bins = UPDOWNpupil.pupcycleUPDOWN.bincenters;

%%
for gg = 1:length(genotypes)
    pupcycleUPDOWN.pDOWN.(genotypes{gg}) = nanmean(pupcycleUPDOWN.ALL.pDOWN(:,:,genotypeidx==gg),3);
    pupcycleUPDOWN.logUPdur.(genotypes{gg}) = nanmean(pupcycleUPDOWN.ALL.logUPdur(:,:,genotypeidx==gg),3);
end

%%
figure
for gg = 1:length(genotypes)
    recs
    for rr = 1:sum(genotypeidx==gg)
        subplot(4,3,rr+(gg-1)*6)
            imagesc(pupcycleUPDOWN.bins,pupcycleUPDOWN.bins,pupcycleUPDOWN.ALL')
            colorbar
            hold on
            plot(pupcycleUPDOWN.bins([1 end]),[0 0],'k--')
            axis xy
            caxis([0 3])
            title(['DOWN rate: ',genotypes{gg}])
            %xlim([-0.6 0.5])
            LogScale('x',10)
            xlabel('Pupil Area');ylabel('dp/dt')
    end
end




%%
figure
for gg = 1:length(genotypes)
    subplot(2,2,gg)
        imagesc(pupcycleUPDOWN.bins,pupcycleUPDOWN.bins,pupcycleUPDOWN.pDOWN.(genotypes{gg})')
        colorbar
        hold on
        plot(pupcycleUPDOWN.bins([1 end]),[0 0],'k--')
        axis xy
        caxis([0 3])
        title(['DOWN rate: ',genotypes{gg}])
        %xlim([-0.6 0.5])
        LogScale('x',10)
        xlabel('Pupil Area');ylabel('dp/dt')
        
        
    subplot(2,2,gg+2)
        imagesc(pupcycleUPDOWN.bins,pupcycleUPDOWN.bins,pupcycleUPDOWN.logUPdur.(genotypes{gg})')
        colorbar
        hold on
        plot(pupcycleUPDOWN.bins([1 end]),[0 0],'k--')
        axis xy
        %caxis([0 3])
        title(['mean UP duration: ',genotypes{gg}])
        LogScale('x',10)
        caxis([-1 1])
        LogScale('c',10)
        xlabel('Pupil Area');ylabel('dp/dt')
end